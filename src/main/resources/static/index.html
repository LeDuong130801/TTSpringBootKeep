<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="cha co gi ma ta">
    <meta name="author" content="Duong">
    <link rel="icon" href="images/favicon.ico">
    <title>KEEP</title>

    <!-- Bootstrap core CSS -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Icons -->

    <link href="css/font-awesome.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="css/dropdown.css">
    <link rel="stylesheet" href="css/modal.css">
    <style>
        body {
            font-family: Arial;
            font-size: 14px;
        }

        .sidebar {
            z-index: 1;
        }

        .active {
            background-color: #5b5eaf !important;
        }

        .tr-1-1 {
            transform: translate(-2px, -1px);
        }

        .mini-nav {
            border-radius: 14px;
            padding-left: 2px;
            margin-bottom: 3px;
        }

        .mini-nav button {
            background-color: transparent !important;
            border: 0px;
            opacity: 0.5;
        }

        .mini-nav button:hover {
            background-color: #5b5eaf !important;
            opacity: 1;
        }

        .btn-mini {
            border-radius: 50%;
        }

        .text-title {
            font-size: 18px;
        }


        .nav-link a:hover {
            background-color: rgb(228, 212, 66) !important;
        }

        .card:hover {
            /* background-color: lightgray; */
            border: black solid 2px;
        }

        .text-black {
            color: black !important;
        }

        .sidebar a {
            text-transform: none;
            font-size: 14px;
        }

        .bg-white {
            color: #ffffff !important;
        }

        .custom-input {
            border: gray solid 2px;
            border-radius: 5px;
        }

        .b-0 {
            border: 0px !important;
        }

        .b-0-bottom-1 {
            border: 0px !important;
            border-bottom: black solid 1px !important;
        }

        .form-control:focus {
            border-color: #ffffff !important;
            box-shadow: 0 0 0px rgba(255, 255, 255, 1) !important;
        }

        #selectTag:focus {
            border-color: #000000 !important;
            box-shadow: 0 0 0px rgba(255, 255, 255, 1) !important;
        }

        #tieuDe {
            display: block;
            overflow: hidden;
            resize: none;
        }

        #noiDung {
            display: block;
            overflow: hidden;
            resize: none;
        }

        .custom-button-o {
            width: 30px;
            height: 30px;
            border-radius: 15px;
        }

        .custom-button-o-small {
            width: 24px;
            height: 24px;
            border-radius: 10px;
        }

        .btn-tran {
            color: black;
            border: transparent;
            background-color: transparent;
        }

        .suatag:hover {
            background-color: lightgray;
        }
    </style>
</head>

<body>
    <div class="container-fluid" id="wrapper">
        <div class="row">
            <div class="modal" tabindex="-1">
                <div class="modal-dialog modal-dialog-scrollable modal-sm modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-body">

                        </div>
                    </div>
                </div>
            </div>
            <div class="modal" id="modalChinhSuaNhan">
                <div class="modal-content">
                    <h5 class="modal-title">Chỉnh sửa nhãn</h5>
                    <div class="row input-group m-0 p-0" id="phanTaoTag">
                        <input type="text" class="form-control b-0-bottom-1 input-group-text text-left"
                            placeholder="Tạo nhãn mới" id="nhanMoi">
                        <div class="input-group-append">
                            <span class="input-group-text bg-white b-0 pt-0 pb-0">
                                <i class="fa fa-check text-dark " id="hoanThanhChinhSuaNhan"></i></span>
                        </div>
                    </div>
                    <span id="phanChinhSuaTag">

                    </span>
                    <div class="modal-footer pt-0">
                        <button type="button" class="btn btn-tran huyChinhSuaNhan" id="dongChinhSuaNhan">Hủy</button>
                        <button type="button" class="btn btn-tran hoanThanhChinhSuaNhan">Xong</button>
                    </div>
                </div>
            </div>
            <div class="modal" id="modalChinhSuaGhiChu">
                <div class="modal-content">
                    <h3 class="modal-title"><input type="text" id="titleSuaGhiChu" class="form-control b-0 text-title">
                    </h3>
                    <div class="row input-group m-0 p-0" id="phanSuaNote">
                        <textarea type="text" class="form-control b-0 text-left" id="contentSuaGhiChu" cols="50"
                            rows="3"></textarea>
                    </div>
                    <div class="modal-footer p-0">
                        <div class="row" id="currentTagSelected">

                        </div>
                        <button class="custom-button-o mr-2" id="btnThemSuaNhan" title=""><i
                                class="fa fa-tag mt-1"></i></button>
                        <button type="button" class="btn btn-tran hoanThanhChinhSuaGhiChu">Đóng</button>
                    </div>
                </div>
            </div>
            <div class="modal" id="modalThemSuaNhan">
                <div class="modal-content">
                    <h3 class="modal-title">
                        Chọn nhãn
                    </h3>
                    <div class="row m-0 p-0" id="phanThemSuaNhan">
                    </div>
                    <div class="modal-footer p-0">
                        <button type="button" class="btn btn-tran hoanThanhThemSuaNhan">Đóng</button>
                    </div>
                </div>
            </div>
            <div class="modal" id="modalLogin">
                <div class="modal-content" style="min-width: 500px;">
                    <div class="container">
                        <label for="uname"><b>Tài khoản</b></label><br>
                        <input type="text" class="form-control" placeholder="Nhập tài khoản" name="uname" id="uname"
                            required>
                        <!-- 
                        <label for="psw"><b>Mật khẩu</b></label><br>
                        <input type="password" class="form-control" placeholder="Nhập mật khẩu" name="psw" id="psw"
                            required>
                        <br> -->
                        <button class="btn btn-success" id="btnLogin" onclick="LoginNow()">Đăng nhập</button>
                        <label>
                            <input type="checkbox" checked="checked" name="remember" id="remember"> Nhớ mật khẩu
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <nav class="sidebar col-xs-12 col-sm-4 col-lg-3 col-xl-2">
                <h1 class="site-title"><a href="index.html"><em class="fa-solid fa-bar"></em>
                        Keep</a></h1>

                <a href="#menu-toggle" class="btn btn-default" id="menu-toggle"><em class="fa fa-bars"></em></a>
                <ul class="nav flex-column" id="nav-slide">
                    <li class="nav-item"><a class="nav-link active" href="#" onclick="openKeep(null)" id="li-all"><em
                                class="fa fa-dashboard"></em>
                            Ghi chú</a></li>
                    <li class="nav-item"><a class="nav-link" href="#"><em class="fa fa-calendar-o"></em>
                            Lời nhắc</a></li>
                    <span id="li-listTagNote"></span>
                    <li class="nav-item"><a class="nav-link" id="moChinhSuaNhan" href="#"><em
                                class="fa fa-bar-chart"></em> Chỉnh sửa nhãn</a></li>
                    <li class="nav-item"><a class="nav-link" href="#"><em class="fa fa-hand-o-up"></em> Lưu
                            trữ</a></li>
                    <li class="nav-item"><a class="nav-link" href="#"><em class="fa fa-pencil-square-o"></em> Thùng
                            rác</a></li>
                </ul>
            </nav>
            <main class="col-xs-12 col-sm-8 col-lg-9 col-xl-10 pt-3 pl-4 ml-auto">
                <header class="page-header row justify-center">
                    <div class="col-sm-6 col-md-8 col-lg-9">
                        <h1 class="float-left text-center text-md-left">Ghi chú</h1>
                    </div>

                    <div class="dropdown col-sm-6 col-md-4 col-lg-3 text-right">
                        <img src="images/profile-pic.jpg" alt="profile photo"
                            class="circle float-right profile-photo dropbtn" width="50" height="auto"
                            onclick="myFunction()">

                        <div id="myDropdown" class="dropdown-content text-left">
                            <img src="images/profile-pic.jpg" alt="profile photo" class="circle profile-photo dropbtn"
                                width="50" height="auto" onclick="myFunction()">
                            <h4 class="mb-1 justify-center" id="usernamebox">Username</h4>
                            <a class="dropdown-item" href="#"><em class="fa fa-user-circle mr-1"></em> View
                                Profile</a>
                            <a class="dropdown-item" href="#"><em class="fa fa-sliders mr-1"></em> Preferences</a>
                            <a class="dropdown-item" onclick="LogOut()" href="#"><em class="fa fa-power-off mr-1"></em>
                                Logout</a>
                        </div>
                    </div>
                </header>
                <section class="row">
                    <div class="col-sm-12">
                        <section class="container" id="phanBenNgoai">
                            <div class="row justify-content-md-center">
                                <div class="col-8 input-group mb-3 custom-input">
                                    <input type="text" class="form-control b-0" placeholder="Tạo ghi chú..."
                                        id="batDauNhap">
                                    <div class="input-group-append">
                                        <span class="input-group-text bg-white b-0"><i
                                                class="fa fa-check-square text-dark"></i></span>
                                    </div>
                                    <div class="input-group-append">
                                        <span class="input-group-text bg-white b-0"><i
                                                class="fa fa-pencil text-dark"></i></span>
                                    </div>
                                    <div class="input-group-append">
                                        <span class="input-group-text bg-white b-0">
                                            <i class="fa fa-image text-dark"></i></span>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <section class="container-fluid" id="phanBenTrong" style="display: none;">
                            <div class="row justify-content-md-center">
                                <div class="col-10 custom-input">
                                    <div class="container-fluid">
                                        <div class="row input-group mb-3 mt-3">
                                            <textarea type="text" class="form-control b-0" placeholder="Tiêu đề"
                                                id="tieuDe" name="tieuDe" rows="1" cols="50"></textarea>
                                            <div class="input-group-append">
                                                <span class="input-group-text bg-white b-0">
                                                    <i class="fa fa-thumb-tack text-dark"></i></span>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <textarea type="text" class="b-0 form-control" id="noiDung" cols="50"
                                                rows="3" placeholder="Tạo ghi chú..."></textarea>
                                        </div>
                                        <div class="row" id="nhanCuaGhiChuMoi">

                                        </div>
                                        <div class="row">
                                            <div class="col-md-10 d-flex flex-row">
                                                <button class="custom-button-o mr-2"><i class="fa fa-plus mt-1"
                                                        title="Thêm"></i></button>
                                                <button class="custom-button-o mr-2" onclick="moThemSuaNhan()"
                                                    title=""><i class="fa fa-tag mt-1"></i></button>
                                                <button class="custom-button-o mr-2"><i
                                                        class="fa fa-rotate-left"></i></button>
                                                <button class="custom-button-o mr-2"><i
                                                        class="fa fa-rotate-right"></i></button>
                                            </div>
                                            <div class="col-md-2 d-flex flex-row-reverse">
                                                <button class="btn btn-tran" id="btnKetThucNhap">Đóng</button>
                                            </div>
                                        </div>
                                        <br>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <br>
                        <section class="container-fluid">
                            <div class="row" id="listNote"></div>
                            <!-- <div class="row">
                                <div class="dropdown">
                                    <button onclick="myFunction()" class="dropbtn">Dropdown</button>
                                    <div id="myDropdown" class="dropdown-content">
                                      <a href="#">Link 1</a>
                                      <a href="#">Link 2</a>
                                      <a href="#">Link 3</a>
                                    </div>
                                  </div>
                            </div> -->
                        </section>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="dist/js/bootstrap.min.js"></script>
    <script src="js/chart.min.js"></script>
    <script src="js/chart-data.js"></script>
    <script src="js/easypiechart.js"></script>
    <script src="js/easypiechart-data.js"></script>
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/custom.js"></script>
    <script>
        function myFunction() {
            document.getElementById("myDropdown").classList.toggle("show");
        }
        function openDropdown(dropdownId) {
            if($("#"+dropdownId).hasClass("show")){
            $(".dropdown-content").removeClass("show");
            }
            else{
            $(".dropdown-content").removeClass("show");
               $("#"+dropdownId).addClass("show");
            }
        }
        </script>
    <script>
        var userid = null;
        var TempTag = [];
        var currentTag = null;
        function loadNote() {
            if (userid === null) {
                return;
            }
            var urlk = "/note/" + userid + "/list"
            if (currentTag !== null) {
                urlk += "/" + currentTag;
            }
            var listTagNoteTemp = [];
            var listTagNoteIdTemp = [];
            $.ajax({
                url: urlk,
                method: "GET",
                contentType: "application/json; charset=UTF-8",
                async: true,
                success: function (data) {
                    $("#listNote").empty();
                    for (let i = 0; i < data.length; i++) {
                        console.log(data[i].content)
                        data[i].content = data[i].content.replace(/\n/g, '<br>');
                        // $("#listNote").append(`<div class="col-lg-3 md-4 mb-3"><div class="card text-dark bg-default"><div class="card-header"><div class="row"><span class="col-8">` + data[i].title + `</span><span class="col-4 text-right"><button onclick="moChinhSuaNote(` + data[i].id + `)" class="custom-button-o-small mr-2"><i
                        //                                 class="fa fa-pencil tr-1-1"></i></button></span></div></div><div class="card-block"><div class="row"><p class="mr-3 ml-3">` + data[i].content + `</p></div><div class="row" id="tagcontent` + data[i].id + `"></div></div>`
                        //     + `</div></div></div>`);
                        $("#listNote").append(`<div class="col-lg-3 md-4 mb-3"><div class="card text-dark bg-default"><div class="card-header"><div class="row"><span class="col-8">` + data[i].title + `</span><span class="col-4 text-right">` +
                                                `<button onclick="openDropdown('myDropdown`+data[i].id+`')" class="custom-button-o-small mr-2 dropbtn"><i
                                                        class="fa fa-pencil tr-1-1"></i></button></span></div></div><div class="card-block"><div class="row"><div id="myDropdown`+data[i].id+`" class="dropdown-content">
                                      <a onclick="moChinhSuaNote(` + data[i].id + `)" href="#">Chỉnh sửa ghi chú</a>
                                      <a href="#">Lưu trữ ghi chú</a>
                                      <a href="#">Xóa ghi chú</a>
                                    </div><p class="mr-3 ml-3">` + data[i].content + `</p></div><div class="row" id="tagcontent` + data[i].id + `"></div></div>`
                            + `</div></div></div>`);
                        for (let j = 0; j < data[i].tagNoteId.length; j++) {
                            if (!listTagNoteIdTemp.includes(data[i].tagNoteId[j])) {
                                $.ajax({
                                    url: "/tagnote/" + userid + "/" + data[i].tagNoteId[j],
                                    method: "GET",
                                    success: function (datatagnote) {
                                        listTagNoteTemp.push(datatagnote);
                                        listTagNoteIdTemp.push(datatagnote.id);
                                        $("#tagcontent" + data[i].id).append('<nav class="ml-2 pl-2 mini-nav bg-primary">' + listTagNoteTemp[listTagNoteIdTemp.indexOf(data[i].tagNoteId[j])].title + '<button class="btn-mini"' + ' onclick="removeTagNotefromTag(' + data[i].id + ',' + data[i].tagNoteId[j] + ')">x</button></nav>');
                                    },
                                    fail: function () { }
                                });
                            }
                            else
                                $("#tagcontent" + data[i].id).append('<nav class="ml-2 pl-2 mini-nav bg-primary">' + listTagNoteTemp[listTagNoteIdTemp.indexOf(data[i].tagNoteId[j])].title + '<button class="btn-mini"' + ' onclick="removeTagNotefromTag(' + data[i].id + ',' + data[i].tagNoteId[j] + ')">x</button></nav>');
                        }
                    }
                }
            });
        }

        function loadAllTagNote() {
            if (userid === null) {
                return;
            }
            $.ajax({
                url: "/tagnote/" + userid + "/list",
                method: "GET",
                contentType: "application/json; charset=UTF-8",
                async: true,
                success: function (data) {
                    $(".taglist-item").remove();
                    $("#phanChinhSuaTag").empty();
                    // $("#selectTag").empty();
                    $("#selectTag").append('<option value=0 selected>Chọn 1 tag bất kỳ</option>');
                    for (let i = 0; i < data.length; i++) {
                        $("#moChinhSuaNhan").before('<li class="nav-item taglist-item" onclick="openKeep(' + data[i].id + ')"><a class="nav-link" href="#" id="li' + data[i].id + '"><em class="fa fa-tag pr-1"></em> ' + data[i].title + '</a></li>');
                        $("#phanChinhSuaTag").append('<div class="row input-group p-0 m-0 rowTagNote">\n' +
                            '<div class="input-group-prepend">\n' +
                            '<span class="input-group-text bg-white b-0 pt-0 pb-0">\n' +
                            '<p class="text-dark fw-bolder pt-2" onclick="deleteTagNote(' + data[i].id + ')"><i class="fa fa-trash text-dark"\n' +
                            'id="d' + data[i].id + '"></i></p></span></div>\n' +
                            '<input type="text" class="form-control b-0 input-group-text text-left" placeholder="" id="i' + data[i].id + '" value="' + data[i].title + '"\n' +
                            '<div class="input-group-append">\n' +
                            '<span class="input-group-text bg-white b-0 pt-0 p-b-0">\n' +
                            '<i class="fa fa-check text-dark suatag" onclick="editTagNote(' + data[i].id + ')"></i></span></div></div>');
                        // $("#selectTag").append('<option value=' + data[i].id + '>' + data[i].title + '</option>');
                    }
                }
            });
        }
        $(document).ready(function () {
            $("#phanBenTrong").hide();
            loadLocalAccount();
            loadNote();
            loadAllTagNote();
            genModalChinhSuaNhan("modalChinhSuaNhan", "moChinhSuaNhan", "dongChinhSuaNhan", "hoanThanhChinhSuaNhan");
            $("#batDauNhap").click(function () {
                $("#phanBenTrong").show();
                $("#phanBenNgoai").hide();
                loadTempTagFromDB(null);
                $("#noiDung").focus();
            });
            $("#btnKetThucNhap").click(function () {
                let tieuDe = $("#tieuDe").val();
                const noiDung = $("#noiDung").val();
                var tag = [];
                if (tieuDe !== "" || noiDung !== "") {
                    for (let i = 0; i < TempTag.length; i++) {
                        if (TempTag[i].isSelected) {
                            tag.push(TempTag[i].id);
                        }
                    }
                    if (noiDung !== "" && tieuDe === "") tieuDe = "Không có tiêu đề";
                    let note = {
                        id: -1,
                        title: tieuDe,
                        content: noiDung,
                        tagNoteId: tag,
                        userid: userid
                    };
                    $.ajax({
                        url: "/note/" + userid,
                        method: "POST",
                        contentType: "application/json; charset=UTF-8",
                        data: JSON.stringify(note)
                    }).done(function () {
                        console.log("Thêm thành công");
                        loadNote()
                    }).fail(function () {
                        console.log("Thêm thất bại");
                    });
                }
                $("#tieuDe").val("");
                $("#noiDung").val("");
                $("#phanBenTrong").hide();
                $("#phanBenNgoai").show();
            });
        });
        function loadLocalAccount() {
            const u = localStorage.getItem("ttspringbootu");
            const p = localStorage.getItem("ttspringbootp");
            if (u !== "" && u !== null) {
                console.log("login")
                processLogin(u, p);
            }
            else openLogin();
        }


        function huyThemGhiChu() {
            TempTag = [];
            $("#tieuDe").val("");
            $("#noiDung").val("");
            $("#phanBenTrong").hide();
            $("#phanBenNgoai").show();
        }
        function genModalChinhSuaNhan(idModal, idOpen, idClose, idCreate) {
            var modal = document.getElementById(idModal);
            $("#" + idOpen).click(function () {
                modal.style.display = "block";
                $("#nhanMoi").focus();
                loadAllTagNote();
            });
            $("#" + idClose).click(function () {
                $("#nhanMoi").val("");
                modal.style.display = "none";
            });
            $("." + idCreate).click(function () {

                const newTagNote = $("#nhanMoi").val();
                if (newTagNote !== "") {
                    const data = {
                        id: -1,
                        title: newTagNote,
                        userid: userid
                    }
                    $.ajax({
                        url: "/tagnote/" + userid,
                        method: "POST",
                        contentType: "application/json; charset=UTF-8",
                        data: JSON.stringify(data),
                        success: function () {
                            loadAllTagNote();
                        }
                    });
                }
                $("#nhanMoi").val("");
                modal.style.display = "none";
            });
            $("#" + idCreate).click(function () {

                const newTagNote = $("#nhanMoi").val();
                if (newTagNote !== "") {
                    // $("#moChinhSua").before('<li class="nav-item"><a class="nav-link text-black" href="#"><em class="fa fa-tag"></em> ' + $("#nhanMoi").val() + '</a></li>');
                    const data = {
                        id: -1,
                        title: newTagNote,
                        userid: userid
                    }
                    $.ajax({
                        url: "/tagnote/" + userid,
                        method: "POST",
                        contentType: "application/json; charset=UTF-8",
                        data: JSON.stringify(data),
                        success: function () {
                            loadAllTagNote();
                        }
                    });
                }
                loadAllTagNote();
                $("#nhanMoi").val("");
            });
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }
        function taoNhanMoi(modal) {
            const newTagNote = $("#nhanMoi").val();
            if (newTagNote !== "") {
                // $("#moChinhSua").before('<li class="nav-item"><a class="nav-link text-black" href="#"><em class="fa fa-tag"></em> ' + $("#nhanMoi").val() + '</a></li>');
                const data = {
                    id: -1,
                    title: newTagNote,
                    userid: userid
                }
                $.ajax({
                    url: "/tagnote/" + userid,
                    method: "POST",
                    contentType: "application/json; charset=UTF-8",
                    data: JSON.stringify(data),
                    success: function () {
                        loadAllTagNote();
                    }
                });
            }
            $("#nhanMoi").val("");
            modal.style.display = "none";
        }
        //xóa nhãn
        function deleteTagNote(id) {
            if (window.confirm("Xóa nhãn này khỏi tất cả ghi chú?") == true) {
                $.ajax({
                    url: "/tagnote/" + userid + "/" + id,
                    method: "DELETE",
                    contentType: "application/json; charset=UTF-8",
                    success: function () {
                        loadAllTagNote();
                        loadNote();
                    }
                });
            }
        }
        //sửa nhãn
        function editTagNote(id) {
            const newtitle = $("#i" + id).val();
            data = {
                id: id,
                title: newtitle,
                userid: userid
            }
            $.ajax({
                url: "/tagnote/" + userid,
                method: "PUT",
                contentType: "application/json; charset=UTF-8",
                data: JSON.stringify(data),
                success: function () {
                    loadAllTagNote();
                }
            });
        }
        //modal thêm nhãn vào ghi chú
        function moThemSuaNhan() {
            var modal = document.getElementById("modalThemSuaNhan");
            modal.style.display = "block";
            $("#phanThemSuaNhan").empty();
            loadTagSelected();
            $(".hoanThanhThemSuaNhan").unbind("click");
            $(".hoanThanhThemSuaNhan").click(function () {
                var modal = document.getElementById("modalThemSuaNhan");
                modal.style.display = "none";
                loadTagSelected();
                for (let i = 0; i < TempTag.length; i++) {
                    if ($("#c" + TempTag[i].id).is(":checked")) {
                        TempTag[i].isSelected = true;
                    }
                    else {
                        TempTag[i].isSelected = false;
                    }
                }
            });
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }
        //modal chỉnh sửa ghi chú
        function moChinhSuaNote(id) {
            huyThemGhiChu();
            var modal = document.getElementById("modalChinhSuaGhiChu");
            var tag = [];
            TempTag = [];
            loadTempTagFromDB(id);
            $.ajax({
                url: "/note/" + userid + "/" + id,
                method: "GET",
                success: function (data) {
                    modal.style.display = "block";
                    $("#titleSuaGhiChu").val(data.title);
                    $("#contentSuaGhiChu").val(data.content);
                    for (let i = 0; i < data.tagNoteId.length; i++) {
                        tag.push(data.tagNoteId[i]);
                    }
                }
            });
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
            $(".hoanThanhChinhSuaGhiChu").unbind("click");
            $(".hoanThanhChinhSuaGhiChu").click(function () {
                var modal = document.getElementById("modalChinhSuaGhiChu");
                modal.style.display = "none";
                tag = [];
                for (let i = 0; i < TempTag.length; i++) {
                    if (TempTag[i].isSelected) {
                        tag.push(TempTag[i].id);
                    }
                }
                const data = {
                    id: id,
                    title: $("#titleSuaGhiChu").val(),
                    content: $("#contentSuaGhiChu").val(),
                    tagNoteId: tag,
                    userid: userid
                }
                $.ajax({
                    url: "/note/" + userid,
                    method: "PUT",
                    contentType: "application/json; charset=UTF-8",
                    data: JSON.stringify(data),
                    success: function () {
                        loadNote();
                        $("#titleSuaGhiChu").val("");
                        $("#contentSuaGhiChu").val("");
                    },
                    fail: function () {
                        $("#titleSuaGhiChu").val("");
                        $("#contentSuaGhiChu").val("");
                    }
                });
            });
            $("#btnThemSuaNhan").unbind("click");
            $("#btnThemSuaNhan").click(function () {
                var modal = document.getElementById("modalThemSuaNhan");
                modal.style.display = "block";
                loadTagSelected();

                $(".hoanThanhThemSuaNhan").unbind("click");
                $(".hoanThanhThemSuaNhan").click(function () {
                    var modal = document.getElementById("modalThemSuaNhan");
                    modal.style.display = "none";
                    loadTagSelected();
                });
                window.onclick = function (event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                }
            })
        }
        //nạp dữ nhãn vào TempTag từ database rồi đưa ra phanBenTrong
        function loadTempTagFromDB(noteid) {
            var listTagId = [];
            // var listTagNote = [];
            TempTag = [];
            $("#currentTagSelected").empty();
            $.ajax({
                url: "/tagnote/" + userid + "/list",
                method: "GET",
                async: true,
                success: function (data) {
                    for (let i = 0; i < data.length; i++) {
                        // let o = { id: data[i].id, title: data[i].title, isSelected: true };
                        TempTag.push({ id: data[i].id, title: data[i].title, isSelected: false });
                    }
                    if (noteid !== null)
                        $.ajax({
                            url: "/note/" + userid + "/" + noteid,
                            method: "GET",
                            success: function (datacheck) {
                                var listTagUsed = datacheck.tagNoteId;
                                for (let i = 0; i < TempTag.length; i++) {
                                    if (listTagUsed.includes(TempTag[i].id)) {
                                        TempTag[i].isSelected = true;
                                    }
                                }
                                loadTagSelected();
                            }
                        });
                    else
                        loadTagSelected();
                }
            });
        }
        //nạp dữ liệu của TempTag
        function loadTagSelected() {
            $("#currentTagSelected").empty();
            $("#phanThemSuaNhan").empty();
            $("#nhanCuaGhiChuMoi").empty();
            for (let i = 0; i < TempTag.length; i++) {
                if (TempTag[i].isSelected) {
                    $("#currentTagSelected").append('<nav class="ml-2 pl-2 pr-2 mini-nav bg-primary">' + TempTag[i].title + '</nav>');
                    $("#phanThemSuaNhan").append('<div class="col-3 form-check">'
                        + '<input class="form-check-input" type="checkbox" value="" onclick="changeCheckbox(' + TempTag[i].id + ')" checked id="c' + TempTag[i].id + '">'
                        + '<p class="form-check-label" for="c' + TempTag[i].id + '">'
                        + TempTag[i].title + '</p></div>');
                    $("#nhanCuaGhiChuMoi").append('<nav class="ml-2 pl-2 pr-2 mini-nav bg-primary">' + TempTag[i].title + '</nav>');
                }
                else {
                    $("#phanThemSuaNhan").append('<div class="col-3 form-check">'
                        + '<input class="form-check-input" type="checkbox" value="" onclick="changeCheckbox(' + TempTag[i].id + ')" id="c' + TempTag[i].id + '">'
                        + '<p class="form-check-label" for="c' + TempTag[i].id + '">'
                        + TempTag[i].title + '</p></div>');
                }
            }
        }
        //xóa nhãn khỏi ghi chú
        function removeTagNotefromTag(noteid, tagNoteId) {
            var m = document.getElementById("modalChinhSuaGhiChu")
            m.style.display = "none";
            $.ajax({
                url: "/note/removetagnoteid/" + tagNoteId,
                method: "PUT",
                contentType: "application/json; charset=UTF-8",
                data: JSON.stringify(noteid),
                success: function () {
                    loadNote();
                }
            });
        }
        function changeCheckbox(cid) {
            if ($("#c" + cid).is(":checked")) {
                TempTag.filter(e => {
                    return e.id === cid;
                })[0].isSelected = true;
            }
            else {
                TempTag.filter(e => {
                    return e.id === cid;
                })[0].isSelected = false;
            }
        }
        //chuyển tab theo nhãn
        function openKeep(tagNoteId) {
            $(".nav-link").removeClass("active");
            if (tagNoteId !== null)
                $("#li" + tagNoteId).addClass("active");
            else $("#li-all").addClass("active");
            var listTagNoteTemp = [];
            var listTagNoteIdTemp = [];
            huyThemGhiChu();
            currentTag = tagNoteId;
            loadNote();
        }
        //đăng nhập
        function openLogin() {
            var modal = document.getElementById("modalLogin");
            modal.style.display = "block";
        }
        function LoginNow() {
            const uname = $("#uname").val();
            const password = $("#psw").val();
            processLogin(uname, password);
        }

        function processLogin(uname, password) {
            let data = { id: -1, username: uname, password: password }
            $.ajax({
                url: "/account",
                data: JSON.stringify(data),
                contentType: "application/json; charset=UTF-8",
                method: "PUT",
                async: true,
                success: function (data1) {
                    if (data1 === 0) {
                        alert("Sai tài khoản hoặc mật khẩu");
                        openLogin();
                        return 0;
                    }
                    userid = data1;
                    var modal = document.getElementById("modalLogin");
                    $("#usernamebox").empty();
                    $("#usernamebox").append(uname);
                    modal.style.display = "none";
                    localStorage.setItem("ttspringbootu", uname);
                    localStorage.setItem("ttspringbootp", password);
                    loadNote();
                    loadAllTagNote();
                    return 1;
                },
                fail: function () {
                    openLogin();
                }
            });
        }
        function LogOut() {
            if (window.confirm("Bạn có muốn đăng xuất") == true) {
                userid = null;
                localStorage.setItem("ttspringbootu", "");
                localStorage.setItem("ttspringbootp", "");
                location.reload();
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"
        integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
        crossorigin="anonymous"></script>
    <script src="js/modal-action.js"></script>

</body>

</html>